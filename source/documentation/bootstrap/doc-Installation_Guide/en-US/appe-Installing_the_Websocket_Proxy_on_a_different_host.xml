<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE appendix PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Installation_Guide.ent">
%BOOK_ENTITIES;
]>
<appendix id="appe-Installing_the_Websocket_Proxy_on_a_different_host">
	<title>Installing a Websocket Proxy on a Separate Machine</title> 
	<para>
	    The websocket proxy allows users to connect to virtual machines via noVNC and SPICE HTML5 consoles. The noVNC client uses websockets to pass VNC data. However, the VNC server in QEMU does not provide websocket support, therefore a websocket proxy must be placed between the client and the VNC server. The proxy can run on any machine that has access to the network, including the the Manager machine.	
   </para>
   <para>
       For security and performance reasons, users may want to configure the websocket proxy on a separate machine.
   </para>
   <note>
       <para>
           SPICE HTML5 support is a Technology Preview feature. Technology Preview features are not fully supported under Red Hat Subscription Service Level Agreements (SLAs), may not be functionally complete, and are not intended for production use. However, these features provide early access to upcoming product innovations, enabling customers to test functionality and provide feedback during the development process. 
       </para>
   </note>
   <para>
       This section describes how to install and configure the websocket proxy on a separate machine that does not run the Manager. See <xref linkend="Red_Hat_Enterprise_Virtualization_Manager_Configuration_Overview"/> for instructions on how to configure the websocket proxy on the Manager.  
   </para>
   <procedure>
       <title>Installing and Configuring a Websocket ProxyÂ on a Separate Machine</title>
       <step>
           <para>
               Install the websocket proxy:
           </para>
           <screen># yum install ovirt-engine-websocket-proxy</screen>
       </step>
		<step>
   		<para>
				Run the <command>engine-setup</command> command to configure the websocket proxy.
			</para>
			<screen># engine-setup</screen>
			<note>
			    <para>If the <package>rhevm</package> package has also been installed, choose <literal>No</literal> when asked to configure the engine on this host.</para>
			</note>
		</step>
		<step>
			<para>
				Press <keycap>Enter</keycap> to allow <command>engine-setup</command> to configure a websocket proxy server on the machine.
			</para>
			<screen>Configure WebSocket Proxy on this machine? (Yes, No) [Yes]:</screen>
		</step>		
		<step>
			<para>
				Press <keycap>Enter</keycap> to accept the automatically detected hostname, or enter an alternative hostname and press <keycap>Enter</keycap>. Note that the automatically detected hostname may be incorrect if you are using virtual hosts:
			</para>
			<screen>Host fully qualified DNS name of this server [<replaceable>host.example.com</replaceable>]: </screen>
		</step>
	   <step>
			<para>
				Press <keycap>Enter</keycap> to allow <command>engine-setup</command> to configure the firewall and open the ports required for external communication. If you do not allow <command>engine-setup</command> to modify your firewall configuration, then you must manually open the required ports.
			</para>
			<screen>Setup can automatically configure the firewall on this system.
Note: automatic configuration of the firewall may overwrite current settings.
Do you want Setup to configure the firewall? (Yes, No) [Yes]:</screen>
		</step>	
		<step>
			<para>
				Enter the fully qualified DNS name of the Manager machine and press <keycap>Enter</keycap>.
			</para>
			<screen>Host fully qualified DNS name of the engine server []: <replaceable>engine_host.example.com</replaceable></screen>
		</step>	
		
		<step>
		    <para>
		    Press <keycap>Enter</keycap> to allow <command>engine-setup</command> to perform actions on the Manager machine, or press <keycap>2</keycap> to manually perform the actions. 
		    </para>
		    <screen>Setup will need to do some actions on the remote engine server. Either automatically, using ssh as root to access it, or you will be prompted to manually perform each such action.
Please choose one of the following:
1 - Access remote engine server using ssh as root
2 - Perform each action manually, use files to copy content around
(1, 2) [1]:</screen>
		    <substeps>
		        <step>
		            <para>
		                Press <keycap>Enter</keycap> to accept the default SSH port number, or enter the port number of the Manager machine.
		            </para>
		            <screen>ssh port on remote engine server [22]:           
		            </screen>
		        </step>
		        
  		        <step>
		            <para>
		                Enter the root password to log in to the Manager machine and press <keycap>Enter</keycap>.
		            </para>
		            <screen>root password on remote engine server <replaceable>engine_host.example.com</replaceable>:        
		            </screen>
		        </step>     
		    </substeps>
		</step>
		<step>
		  <para>
		     Select whether to review iptables rules if they differ from the current settings.
		  </para>
		  <screen>Generated iptables rules are different from current ones.
Do you want to review them? (Yes, No) [No]:</screen>
		</step>
		<step>
		    <para>
		       Press <keycap>Enter</keycap> to confirm the configuration settings. 
		    </para>
		    <screen>--== CONFIGURATION PREVIEW ==--
         
Firewall manager                        : iptables
Update Firewall                         : True
Host FQDN                               : host.example.com
Configure WebSocket Proxy               : True
Engine Host FQDN                        : engine_host.example.com
         
Please confirm installation settings (OK, Cancel) [OK]:</screen>		
             <para>
                Instructions are provided to configure the Manager machine to use the configured websocket proxy.  
             </para>
   <screen>Manual actions are required on the engine host
in order to enroll certs for this host and configure the engine about it.
         
Please execute this command on the engine host: 
   engine-config -s WebSocketProxy=host.example.com:6100
and than restart the engine service to make it effective</screen>
		</step> 
      <step>
          <para>Log in to the Manager machine and execute the provided instructions.</para>
   <screen># engine-config -s WebSocketProxy=host.example.com:6100
# systemctl restart ovirt-engine.service
   </screen>       
      </step>
   </procedure>
</appendix>
