<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Administration_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="Backing_Up_a_Virtual_Machine" remap="TID_41422">
	<title>Backing Up a Virtual Machine</title>
	<para>
		Use the backup and restore <acronym>API</acronym> to back up a virtual machine. This procedure assumes you have two virtual machines: the virtual machine to back up, and a virtual machine on which the software for managing the backup is installed.
	</para>
	<procedure>
		<title>Backing Up a Virtual Machine</title>
		<step>
			<para>
				Using the <acronym>REST</acronym> <acronym>API</acronym>, create a snapshot of the virtual machine to back up:
			</para>
			<screen>POST /api/vms/<replaceable>11111111-1111-1111-1111-111111111111</replaceable>/snapshots/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;snapshot&gt;
    &lt;description&gt;BACKUP&lt;/description&gt;
&lt;/snapshot&gt;</screen>
			<note>
				<para>
					When you take a snapshot of a virtual machine, a copy of the configuration data of the virtual machine as at the time the snapshot was taken is stored in the <literal>data</literal> attribute of the <literal>configuration</literal> attribute in <literal>initialization</literal> under the snapshot.
				</para>
			</note>
			<important>
				<para>
					You cannot take snapshots of disks that are marked as shareable or that are based on direct <acronym>LUN</acronym> disks.
				</para>
			</important>
		</step>
		<step>
			<para>
				Retrieve the configuration data of the virtual machine from the <literal>data</literal> attribute under the snapshot:
			</para>
			<screen>GET /api/vms/<replaceable>11111111-1111-1111-1111-111111111111</replaceable>/snapshots/<replaceable>11111111-1111-1111-1111-111111111111</replaceable> HTTP/1.1
Accept: application/xml
Content-type: application/xml</screen>
		</step>
		<step>
			<para>
				Identify the disk ID and snapshot ID of the snapshot:
			</para>
			<screen>GET /api/vms/<replaceable>11111111-1111-1111-1111-111111111111</replaceable>/snapshots/<replaceable>11111111-1111-1111-1111-111111111111</replaceable>/disks HTTP/1.1
Accept: application/xml
Content-type: application/xml</screen>
		</step>
		<step>
			<para>
				Attach the snapshot to the backup virtual machine and activate the disk:
			</para>
			<screen>POST /api/vms/<replaceable>22222222-2222-2222-2222-222222222222</replaceable>/disks/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;disk id="<replaceable>11111111-1111-1111-1111-111111111111</replaceable>"&gt;
    &lt;snapshot id="<replaceable>11111111-1111-1111-1111-111111111111</replaceable>"/&gt;
    &lt;active&gt;true&lt;/active&gt;
&lt;/disk&gt;
</screen>
		</step>
		<step>
			<para>
				Use the backup software on the backup virtual machine to back up the data on the snapshot disk.
			</para>
		</step>
		<step>
			<para>
				Detach the snapshot disk from the backup virtual machine:
			</para>
			<screen>DELETE /api/vms/<replaceable>22222222-2222-2222-2222-222222222222</replaceable>/disks/<replaceable>11111111-1111-1111-1111-111111111111</replaceable> HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;action&gt;
    &lt;detach&gt;true&lt;/detach&gt;
&lt;/action&gt;
</screen>
		</step>
		<step>
			<para>
				Optionally, delete the snapshot:
			</para>
			<screen>DELETE /api/vms/<replaceable>11111111-1111-1111-1111-111111111111</replaceable>/snapshots/<replaceable>11111111-1111-1111-1111-111111111111</replaceable> HTTP/1.1
Accept: application/xml
Content-type: application/xml</screen>
		</step>
	</procedure>
	<para>
		You have backed up the state of a virtual machine at a fixed point in time using backup software installed on a separate virtual machine.
	</para>
</section>