<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Administration_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="Settings_to_Wipe_Virtual_Disks_After_Deletion" remap="TID_42100">
	<title>Settings to Wipe Virtual Disks After Deletion</title>
   <para>
      The <literal>wipe_after_delete</literal> flag, viewed in the Administration Portal as the <guilabel>Wipe After Delete</guilabel> check box will replace used data with zeros when a virtual disk is deleted. If it is set to false, which is the default, deleting the disk will open up those blocks for re-use but will not wipe the data. It is, therefore, possible for this data to be recovered because the blocks have not been returned to zero.
   </para>
   <para>
      The <literal>wipe_after_delete</literal> flag only works on block storage. On file storage, for example NFS, the option does nothing because the file system will ensure that no data exists.
   </para>
   <para>
      Enabling <literal>wipe_after_delete</literal> for virtual disks is more secure, and is recommended if the virtual disk has contained any sensitive data. This is a more intensive operation and users may experience degradation in performance and prolonged delete times.
   </para>
   <note>
       <para>
           The wipe after delete functionality is not the same as secure delete, and cannot guarantee that the data is removed from the storage, just that new disks created on same storage will not expose data from old disks.
       </para>
   </note>
   <para>
		The <literal>wipe_after_delete</literal> flag default can be changed to <literal>true</literal> during the setup process (see <ulink url="https://access.redhat.com/documentation/en/red-hat-virtualization/4.0/single/installation-guide/#Red_Hat_Enterprise_Virtualization_Manager_Configuration_Overview">Configuring the Red Hat Virtualization Manager</ulink> in the <citetitle>Installation Guide</citetitle>), or by using the engine configuration tool on the Red Hat Virtualization Manager. Restart the engine for the setting change to take effect.
	</para>
	<procedure>
		<title>Setting SANWipeAfterDelete to Default to True Using the Engine Configuration Tool</title>
		<step>
			<para>
				Run the engine configuration tool with the <literal>--set</literal> action:
			</para>
			<screen>
# engine-config --set SANWipeAfterDelete=true
		</screen>
		</step>
		<step>
			<para>
				Restart the engine for the change to take effect:
			</para>
			<screen>
# systemctl restart ovirt-engine.service
		</screen>
		</step>
	</procedure>
	<para>
	    The <filename>/var/log/vdsm/vdsm.log</filename> file located on the host can be checked to confirm that a virtual disk was successfully wiped and deleted.
	</para>
	<para>
	    For a successful wipe, the log file will contain the entry, <literal><replaceable>storage_domain_id</replaceable>/<replaceable>volume_id</replaceable> was zeroed and will be deleted</literal>. For example:
	</para>
	<screen>
a9cb0625-d5dc-49ab-8ad1-72722e82b0bf/a49351a7-15d8-4932-8d67-512a369f9d61 was zeroed and will be deleted
	</screen>
	<para>
	    For a successful deletion, the log file will contain the entry, <literal>finished with VG:<replaceable>storage_domain_id</replaceable> LVs: <replaceable>list_of_volume_ids</replaceable>, img: <replaceable>image_id</replaceable></literal>. For example:
	</para>
	<screen>
finished with VG:a9cb0625-d5dc-49ab-8ad1-72722e82b0bf LVs: {'a49351a7-15d8-4932-8d67-512a369f9d61': ImgsPar(imgs=['11f8b3be-fa96-4f6a-bb83-14c9b12b6e0d'], parent='00000000-0000-0000-0000-000000000000')}, img: 11f8b3be-fa96-4f6a-bb83-14c9b12b6e0d	
	</screen>
	<para>
	    An unsuccessful wipe will display a log message <literal>zeroing <replaceable>storage_domain_id</replaceable>/<replaceable>volume_id</replaceable> failed. Zero and remove this volume manually</literal>, and an unsuccessful delete will display <literal>Remove failed for some of VG: <replaceable>storage_domain_id</replaceable> zeroed volumes: <replaceable>list_of_volume_ids</replaceable></literal>.
	</para>
</section>
