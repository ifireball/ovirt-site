<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Virtual_Machine_Management_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Templates">
	<title>Templates</title> 
	<para>
		A template is a copy of a virtual machine that you can use to simplify the subsequent, repeated creation of similar virtual machines. Templates capture the configuration of software, configuration of hardware, and the software installed on the virtual machine on which the template is based. The virtual machine on which a template is based is known as the source virtual machine.
	</para>
	<para>
		When you create a template based on a virtual machine, a read-only copy of the virtual machine's disk is created. This read-only disk becomes the base disk image of the new template, and of any virtual machines created based on the template. As such, the template cannot be deleted while any virtual machines created based on the template exist in the environment.
	</para>
	<para>
		Virtual machines created based on a template use the same <acronym>NIC</acronym> type and driver as the original virtual machine, but are assigned separate, unique <acronym>MAC</acronym> addresses.
	</para>
		<para>
			You can create a virtual machine directly from the <guilabel>Templates</guilabel> tab, as well as from the <guilabel>Virtual Machines</guilabel> tab. In the <guilabel>Templates</guilabel> tab, right-click the required template and select <guilabel>New VM</guilabel>. For more information on selecting the settings and controls for the new virtual machine see <xref linkend="Virtual_Machine_General_settings_explained" />.
		</para>
        <section id="sect-Sealing_Virtual_Machines_in_Preparation_for_Deployment_as_Templates">
		<title>Sealing Virtual Machines in Preparation for Deployment as Templates</title> 
		<para>
			This section describes procedures for sealing Linux virtual machines and Windows virtual machines. Sealing is the process of removing all system-specific details from a virtual machine before creating a template based on that virtual machine. Sealing is necessary to prevent the same details from appearing on multiple virtual machines created based on the same template. It is also necessary to ensure the functionality of other features, such as predictable <acronym>vNIC</acronym> order.
		</para>
		<section id="sect-Sealing_a_Linux_Virtual_Machine_for_Deployment_as_a_Template">
			<title>Sealing a Linux Virtual Machine for Deployment as a Template</title> 
			<para>
				There are two main methods for sealing a Linux virtual machine in preparation for using that virtual machine to create a template: manually, or using the <command>sys-unconfig</command> command. Sealing a Linux virtual machine manually requires you to create a file on the virtual machine that acts as a flag for initiating various configuration tasks the next time you start that virtual machine. The <command>sys-unconfig</command> command allows you to automate this process. However, both of these methods also require you to manually delete files on the virtual machine that are specific to that virtual machine or might cause conflicts amongst virtual machines created based on the template you will create based on that virtual machine. As such, both are valid methods for sealing a Linux virtual machine and will achieve the same result.
			</para>
			<xi:include href="topics/Sealing_a_Linux_template.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
			<xi:include href="topics/Sealing_a_Linux_Virtual_Machine_for_Deployment_as_a_Template_using_sys-unconfig.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		</section>
		<section id="sect-Sealing_a_Windows_Virtual_Machine_for_Deployment_as_a_Template">
			<title>Sealing a Windows Virtual Machine for Deployment as a Template</title> 
			<para>
				A template created for Windows virtual machines must be generalized (sealed) before being used to deploy virtual machines. This ensures that machine-specific settings are not reproduced in the template.
			</para>
			<para>
				The <application>Sysprep</application> tool is used to seal Windows templates before use.
			</para>
			<important>
				<para>
					Do not reboot the virtual machine during this process.
				</para>
			</important>
			<para>
				Before starting the <application>Sysprep</application> process, verify that the following settings are configured: 
				<itemizedlist>
					<listitem>
						<para>
							The Windows <application>Sysprep</application> parameters have been correctly defined.
						</para>
						<para>
							If not, click <guibutton>Edit</guibutton> and enter the required information in the <guilabel>Operating System</guilabel> and <guilabel>Domain</guilabel> fields.
						</para>
					</listitem>
					<listitem>
						<para>
                                                    The correct product key has been defined in an override file on the Manager. 
                                                </para>
                                                <para>
                                                    The override file needs to be created under <filename>/etc/ovirt-engine/osinfo.conf.d/</filename>, have a filename that puts it after <filename>/etc/ovirt-engine/osinfo.conf.d/00-defaults.properties</filename>, and end in <filename>.properties</filename>. For example, <filename>/etc/ovirt-engine/osinfo.conf.d/10-productkeys.properties</filename>. The last file will have precedent and override any other previous file. 
						</para>
						<para>
							If not, copy the default values for your Windows operating system from <filename>/etc/ovirt-engine/osinfo.conf.d/00-defaults.properties</filename> into the override file, and input your values in the <literal>productKey.value</literal> and <literal>sysprepPath.value</literal> fields.
						</para>
						<example>
							<title>Windows 7 Default Configuration Values</title>
							<screen># Windows7(11, OsType.Windows, false),false
os.windows_7.id.value = 11
os.windows_7.name.value = Windows 7
os.windows_7.derivedFrom.value = windows_xp
os.windows_7.sysprepPath.value = ${ENGINE_USR}/conf/sysprep/sysprep.w7
os.windows_7.productKey.value =
os.windows_7.devices.audio.value = ich6
os.windows_7.devices.diskInterfaces.value.3.3 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.devices.diskInterfaces.value.3.4 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.devices.diskInterfaces.value.3.5 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.isTimezoneTypeInteger.value = false
</screen>
						</example>
					</listitem>
				</itemizedlist>
			</para>
			<xi:include href="topics/Sealing_a_Windows_7_or_Windows_2008_template.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		</section>
            </section>
    <xi:include href="topics/Creating_a_template_from_an_existing_virtual_machine.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="topics/Editing_a_Template.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="topics/Deleting_a_template.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		<section id="sect-Exporting_Templates">
			<title>Exporting Templates</title>
			<xi:include href="topics/Exporting_individual_templates_to_the_export_domain.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
			<xi:include href="topics/Copying_a_Virtual_Machine_Hard_Disk.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		</section>
		<section id="sect-Importing_Templates">
			<title>Importing Templates</title>
			<xi:include href="topics/Importing_a_template_into_a_data_center.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
			<xi:include href="topics/Importing_a_Virtual_Disk_Image_from_an_OpenStack_Image_Service_as_a_Template.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		</section>
	<section id="sect-Templates_and_Permissions">
		<title>Templates and Permissions</title>
		<xi:include href="topics/Data_center_related_entities.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		<xi:include href="topics/Logical_network_properties.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		<xi:include href="topics/Template_User_Roles_Explained.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		<xi:include href="topics/To_assign_a_system_administrator_role_to_a_data_center.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		<xi:include href="topics/To_remove_a_system_administrator_role_to_a_data_center.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
	</section>
		<section id="sect-Using_Cloud-Init_to_Automate_the_Configuration_of_Virtual_Machines">
			<title>Using Cloud-Init to Automate the Configuration of Virtual Machines</title> 
			<para>
				Cloud-Init is a tool for automating the initial setup of virtual machines such as configuring the host name, network interfaces, and authorized keys. It can be used when provisioning virtual machines that have been deployed based on a template to avoid conflicts on the network.
			</para>
			<para>
				To use this tool, the <package>cloud-init</package> package must first be installed on the virtual machine. Once installed, the Cloud-Init service starts during the boot process to search for instructions on what to configure. You can then use options in the <guilabel>Run Once</guilabel> window to provide these instructions one time only, or options in the <guilabel>New Virtual Machine</guilabel>, <guilabel>Edit Virtual Machine</guilabel> and <guilabel>Edit Template</guilabel> windows to provide these instructions every time the virtual machine starts.
			</para>
			<xi:include href="topics/Cloud-Init_Use_Case_Scenarios.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
			<xi:include href="topics/Installing_Cloud-Init.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
			<xi:include href="topics/Using_Cloud-Init_to_Prepare_a_Template.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
			<xi:include href="topics/Using_Cloud-Init.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
		</section>
	<xi:include href="topics/Creating_a_new_virtual_machine_from_an_existing_template.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
	<xi:include href="topics/Creating_a_cloned_virtual_machine_from_an_existing_template.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
</chapter>


