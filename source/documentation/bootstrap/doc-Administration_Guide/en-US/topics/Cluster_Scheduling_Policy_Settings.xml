<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "../Administration_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="Cluster_Scheduling_Policy_Settings">
	<title>Scheduling Policy Settings Explained</title>
	<para>
		Scheduling policies allow you to specify the usage and distribution of virtual machines between available hosts. Define the scheduling policy to enable automatic load balancing across the hosts in a cluster.
	</para>
	<para>
	   To add a scheduling policy to an existing cluster, click the <guilabel>Clusters</guilabel> tab and click the <guibutton>Edit</guibutton> button, then click the <guilabel>Scheduling Policy</guilabel> tab.
	</para>
	<para>
		<figure>
			<title>Scheduling Policy Settings: vm_evenly_distributed</title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/7333.png" />
				</imageobject>
			</mediaobject>
		</figure>
	</para>
	<para>
		The table below describes the settings for the <guilabel>Scheduling Policy</guilabel> tab.
	</para>
	<table frame="all" id="Cluster-General">
		<title>Scheduling Policy Tab Properties</title>
		<tgroup align="left" cols="2" colsep="1" rowsep="1">
			<colspec colname="c1" />
			<colspec colname="c2" />
			<thead>
				<row>
					<entry>
						<para>
							Field
						</para>
					</entry>
					<entry>
						<para>
							Description/Action
						</para>
					</entry>
				</row>
			</thead>
			<tbody>
				<row>
					<entry>
						<para>
							<guilabel>Select Policy</guilabel>
						</para>
					</entry>
					<entry>
						<para>
							Select a policy from the drop-down list.
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<guilabel>none</guilabel>: Set the policy value to <guilabel>none</guilabel> to have no load or power sharing between hosts. This is the default mode.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>evenly_distributed</guilabel>: Distributes the memory and CPU processing load evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined Maximum Service Level.
								</para>
							</listitem>
							<listitem>
								<para> 
									<guilabel>InClusterUpgrade</guilabel>: Distributes virtual machines based on host operating system version. Hosts with a newer operating system than the virtual machine currently runs on are given priority over hosts with the same operating system. Virtual machines that migrate to a host with a newer operating system will not migrate back to an older operating system. A virtual machine can restart on any host in the cluster. The policy allows hosts in the cluster to be upgraded by allowing the cluster to have mixed operating system versions. Preconditions must be met before the policy can be enabled. See the <ulink url="https://access.redhat.com/documentation/en/red-hat-virtualization/4.0/paged/upgrade-guide/Upgrading_a_Red_Hat_Enterprise_Linux_6_Cluster_to_Red_Hat_Enterprise_Linux_7.html"><citetitle>Upgrade Guide</citetitle></ulink> for more information.
								</para>
							</listitem>

							<listitem>
								<para>
									<guilabel>power_saving</guilabel>: Distributes the memory and CPU processing load across a subset of available hosts to reduce power consumption on underutilized hosts. Hosts with a CPU load below the low utilization value for longer than the defined time interval will migrate all virtual machines to other hosts so that it can be powered down. Additional virtual machines attached to a host will not start if that host has reached the defined high utilization value.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>vm_evenly_distributed</guilabel>: Distributes virtual machines evenly between hosts based on a count of the virtual machines. The cluster is considered unbalanced if any host is running more virtual machines than the <guilabel>HighVmCount</guilabel> and there is at least one host with a virtual machine count that falls outside of the <guilabel>MigrationThreshold</guilabel>.
								</para>
							</listitem>
						</itemizedlist>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							<guilabel>Properties</guilabel>
						</para>
					</entry>
					<entry>
						<para>
							The following properties appear depending on the selected policy, and can be edited if necessary:
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<guilabel>HighVmCount</guilabel>: Sets the maximum number of virtual machines that can run on each host. Exceeding this limit qualifies the host as overloaded. The default value is <guilabel>10</guilabel>.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>MigrationThreshold</guilabel>: Defines a buffer before virtual machines are migrated from the host. It is the maximum inclusive difference in virtual machine count between the most highly-utilized host and the least-utilized host. The cluster is balanced when every host in the cluster has a virtual machine count that falls inside the migration threshold. The default value is <guilabel>5</guilabel>.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>SpmVmGrace</guilabel>: Defines the number of slots for virtual machines to be reserved on SPM hosts. The SPM host will have a lower load than other hosts, so this variable defines how many fewer virtual machines than other hosts it can run. The default value is <guilabel>5</guilabel>.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>CpuOverCommitDurationMinutes</guilabel>: Sets the time (in minutes) that a host can run a CPU load outside of the defined utilization values before the scheduling policy takes action. The defined time interval protects against temporary spikes in CPU load activating scheduling policies and instigating unnecessary virtual machine migration. Maximum two characters. The default value is <guilabel>2</guilabel>.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>HighUtilization</guilabel>: Expressed as a percentage. If the host runs with CPU usage at or above the high utilization value for the defined time interval, the Red Hat Virtualization Manager migrates virtual machines to other hosts in the cluster until the host's CPU load is below the maximum service threshold. The default value is <guilabel>80</guilabel>.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>LowUtilization</guilabel>: Expressed as a percentage. If the host runs with CPU usage below the low utilization value for the defined time interval, the Red Hat Virtualization Manager will migrate virtual machines to other hosts in the cluster. The Manager will power down the original host machine, and restart it again when load balancing requires or there are not enough free hosts in the cluster. The default value is <guilabel>20</guilabel>.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>ScaleDown</guilabel>: Reduces the impact of the <guilabel>HA Reservation</guilabel> weight function, by dividing a host's score by the specified amount. This is an optional property that can be added to any policy, including <guilabel>none</guilabel>.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>HostsInReserve</guilabel>: Specifies a number of hosts to keep running even though there are no running virtual machines on them. This is an optional property that can be added to the <guilabel>power_saving</guilabel> policy.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>EnableAutomaticHostPowerManagement</guilabel>: Enables automatic power management for all hosts in the cluster. This is an optional property that can be added to the <guilabel>power_saving</guilabel> policy. The default value is <guilabel>true</guilabel>.
								</para>
							</listitem>
              <listitem>
								<para> 
									<guilabel>MaxFreeMemoryForOverUtilized</guilabel>: Sets the maximum free memory required in MB for the minimum service level. If the host's memory usage runs at, or above this value, the Red Hat Virtualization Manager migrates virtual machines to other hosts in the cluster until the host's available memory is below the minimum service threshold. Setting both <guilabel>MaxFreeMemoryForOverUtilized</guilabel> and <guilabel>MinFreeMemoryForUnderUtilized</guilabel> to 0 MB disables memory based balancing. This is an optional property that can be added to the <guilabel>power_saving</guilabel> and <guilabel>evenly_distributed</guilabel> policies.
								</para>
							</listitem>
                                                        <listitem>
								<para> 
									<guilabel>MinFreeMemoryForUnderUtilized</guilabel>: Sets the minimum free memory required in MB before the host is considered underutilized. If the host's memory usage runs below this value, the Red Hat Virtualization Manager migrates virtual machines to other hosts in the cluster and will automatically power down the host machine, and restart it again when load balancing requires or there are not enough free hosts in the cluster. Setting both <guilabel>MaxFreeMemoryForOverUtilized</guilabel> and <guilabel>MinFreeMemoryForUnderUtilized</guilabel> to 0MB disables memory based balancing. This is an optional property that can be added to the <guilabel>power_saving</guilabel> and <guilabel>evenly_distributed</guilabel> policies.
								</para>
							</listitem>
						</itemizedlist>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							<guilabel>Scheduler Optimization</guilabel>
						</para>
					</entry>
					<entry>
						<para>
							Optimize scheduling for host weighing/ordering.
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<guilabel>Optimize for Utilization</guilabel>: Includes weight modules in scheduling to allow best selection.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>Optimize for Speed</guilabel>: Skips host weighting in cases where there are more than ten pending requests.
								</para>
							</listitem>
						</itemizedlist>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							<guilabel>Enable Trusted Service</guilabel>
						</para>
					</entry>
					<entry>
						<para>
							Enable integration with an OpenAttestation server. Before this can be enabled, use the <command>engine-config</command> tool to enter the OpenAttestation server's details. For more information, see <xref linkend="sect-Trusted_Compute_Pools"/>.
						</para>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							<guilabel>Enable HA Reservation</guilabel>
						</para>
					</entry>
					<entry>
						<para>
							Enable the Manager to monitor cluster capacity for highly available virtual machines. The Manager ensures that appropriate capacity exists within a cluster for virtual machines designated as highly available to migrate in the event that their existing host fails unexpectedly.
						</para>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							<guilabel>Provide custom serial number policy</guilabel>
						</para>
					</entry>
					<entry>
						<para>
							This check box allows you to specify a serial number policy for the virtual machines in the cluster. Select one of the following options:
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<guilabel>Host ID</guilabel>: Sets the host's UUID as the virtual machine's serial number.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>Vm ID</guilabel>: Sets the virtual machine's UUID as its serial number.
								</para>
							</listitem>
							<listitem>
								<para>
									<guilabel>Custom serial number</guilabel>: Allows you to specify a custom serial number.
								</para>
							</listitem>
						</itemizedlist>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							<guilabel>Auto Converge migrations</guilabel>
						</para>
					</entry>
					<entry>
						<para>
							This option allows you to set whether auto-convergence is used during live migration of virtual machines in the cluster. Large virtual machines with high workloads can dirty memory more quickly than the transfer rate achieved during live migration, and prevent the migration from converging. Auto-convergence capabilities in QEMU allow you to force convergence of virtual machine migrations. QEMU automatically detects a lack of convergence and triggers a throttle-down of the vCPUs on the virtual machines. Auto-convergence is disabled globally by default.
						</para>
						<itemizedlist>
							<listitem>
								<para>
									Select <guilabel>Inherit from global setting</guilabel> to use the auto-convergence setting that is set at the global level with <command>engine-config</command>. This option is selected by default.
								</para>
							</listitem>
							<listitem>
								<para>
									Select <guilabel>Auto Converge</guilabel> to override the global setting and allow auto-convergence for virtual machines in the cluster.
								</para>
							</listitem>
							<listitem>
								<para>
									Select <guilabel>Don't Auto Converge</guilabel> to override the global setting and prevent auto-convergence for virtual machines in the cluster.
								</para>
							</listitem>
						</itemizedlist>
					</entry>
				</row>
				<row>
					<entry>
						<para>
							<guilabel>Enable migration compression</guilabel>
						</para>
					</entry>
					<entry>
						<para>
							This option allows you to set whether migration compression is used during live migration of virtual machines in the cluster. This feature uses Xor Binary Zero Run-Length-Encoding to reduce virtual machine downtime and total live migration time for virtual machines running memory write-intensive workloads or for any application with a sparse memory update pattern. Migration compression is disabled globally by default.
						</para>
						<itemizedlist>
							<listitem>
								<para>
									Select <guilabel>Inherit from global setting</guilabel> to use the compression setting that is set at the global level with <command>engine-config</command>. This option is selected by default.
								</para>
							</listitem>
							<listitem>
								<para>
									Select <guilabel>Compress</guilabel> to override the global setting and allow compression for virtual machines in the cluster.
								</para>
							</listitem>
							<listitem>
								<para>
									Select <guilabel>Don't compress</guilabel> to override the global setting and prevent compression for virtual machines in the cluster.
								</para>
							</listitem>
						</itemizedlist>
					</entry>
				</row>
			</tbody>
		</tgroup>
	</table>
	<para>
		When a host's free memory drops below 20%, ballooning commands like <command>mom.Controllers.Balloon - INFO Ballooning guest:half1 from 1096400 to 1991580</command> are logged to <filename>/var/log/vdsm/mom.log</filename>. <filename>/var/log/vdsm/mom.log</filename> is the Memory Overcommit Manager log file.
	</para>
</section>



